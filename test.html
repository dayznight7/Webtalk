<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test</title>
</head>
<body>

  <p id="mycount"></p>
  <button type="button" onclick="writeRTDB('test_sender','test_receiver')">writeRTDB</button>

  <!--firebase7/8/9 CDN (now 8)-->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="js/firebase_config.js"></script>

  <script>
    // Get a reference to the database service
    //var database = firebase.database();

    function writeRTDB(sender, receiver) {

      var dbRef = firebase.database().ref("mailbox/" + receiver + "/" + sender);

      dbRef.get().then((snapshot) => {
        if (snapshot.exists()) {
          dbRef.set({
            unread: snapshot.val().unread + 1
          });
        }
        else {
          dbRef.set({
            unread: 1
          });
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    var mycount = document.getElementById("mycount");
    var countRef = firebase.database().ref("mailbox/test_receiver/test_sender");
    countRef.on("value", (snapshot) => {
      mycount.innerHTML = snapshot.val().unread;
    });

  </script>

</body>
</html>